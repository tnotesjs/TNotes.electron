# [0046. è®¤è¯† IPC ç›¸å…³æ¨¡å—](https://github.com/Tdahuyou/electron/tree/main/0046.%20%E8%AE%A4%E8%AF%86%20IPC%20%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97)

<!-- region:toc -->
- [1. ğŸ“ Summary](#1--summary)
- [2. ğŸ”— links](#2--links)
- [3. ğŸ’¡ å¯¼å›¾](#3--å¯¼å›¾)
- [4. ğŸ“ electron doc - è¿›ç¨‹é—´é€šä¿¡æ•™ç¨‹](#4--electron-doc---è¿›ç¨‹é—´é€šä¿¡æ•™ç¨‹)
- [5. ğŸ“ send vs. sendSync](#5--send-vs-sendsync)
  - [5.1. sendã€sendSync æ˜¯ä»€ä¹ˆ](#51-sendsendsync-æ˜¯ä»€ä¹ˆ)
  - [5.2. åŒæ­¥ vs. å¼‚æ­¥](#52-åŒæ­¥-vs-å¼‚æ­¥)
  - [5.3. è¿”å›å€¼](#53-è¿”å›å€¼)
  - [5.4. çœ‹çœ‹å®˜æ–¹å»ºè®®](#54-çœ‹çœ‹å®˜æ–¹å»ºè®®)
- [6. ğŸ“ send vs. invoke](#6--send-vs-invoke)
  - [6.1. å…ˆç»™å‡ºç»“è®º](#61-å…ˆç»™å‡ºç»“è®º)
  - [6.2. åœºæ™¯ - åŒå‘é€šä¿¡](#62-åœºæ™¯---åŒå‘é€šä¿¡)
  - [6.3. åœºæ™¯ - å•å‘é€šä¿¡](#63-åœºæ™¯---å•å‘é€šä¿¡)
- [7. ğŸ¤” é—®ï¼šä½¿ç”¨ send æ¥å®ç°å•å‘é€šä¿¡èƒ½å‡å°‘å¼€é”€æé«˜æ€§èƒ½ï¼Ÿ](#7--é—®ä½¿ç”¨-send-æ¥å®ç°å•å‘é€šä¿¡èƒ½å‡å°‘å¼€é”€æé«˜æ€§èƒ½)
<!-- endregion:toc -->
## 1. ğŸ“ Summary
- æŠŠå®˜æ–¹æ•™ç¨‹ä¸­æåˆ°çš„ IPC é€šä¿¡æ¨¡å¼åˆ·ä¸€é
- è®¤è¯†ç”¨äºå®ç° IPC é€šä¿¡çš„æ¨¡å— ipcMainã€ipcRenderer
- send å’Œ sendSync ä¹‹é—´çš„ä¸€äº›å·®å¼‚ï¼ˆè¿™ä¿© API â€œå·²è¿‡æ—¶â€ï¼‰
- invoke æ¯” send å¥½åœ¨å“ª

## 2. ğŸ”— links

- https://www.electronjs.org/zh/docs/latest/tutorial/ipc
  - è¿™æ˜¯å®˜æ–¹æä¾›çš„ IPC é€šä¿¡æ•™ç¨‹ã€‚
- https://www.electronjs.org/docs/latest/tutorial/ipc#note-legacy-approaches
  - å®˜æ–¹å»ºè®® - æ¨èä½¿ç”¨ invoke çš„è¯´æ˜ã€‚

## 3. ğŸ’¡ å¯¼å›¾

![](md-imgs/2024-10-05-22-33-26.png)

## 4. ğŸ“ electron doc - è¿›ç¨‹é—´é€šä¿¡æ•™ç¨‹

> from: https://www.electronjs.org/zh/docs/latest/tutorial/ipc

è¿™æ˜¯å®˜æ–¹æä¾›çš„ IPC é€šä¿¡æ•™ç¨‹ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š

- ä¸Šä¸‹æ–‡éš”ç¦»è¿›ç¨‹
- ä¸€äº›åŸºæœ¬çš„ IPC é€šä¿¡æ¨¡å¼ï¼Œå¹¶æä¾›äº†å…·ä½“çš„ç¤ºä¾‹ã€‚
  - æ¨¡å¼ 1ï¼šæ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘ï¼‰
  - æ¨¡å¼ 2ï¼šæ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰
  - æ¨¡å¼ 3ï¼šä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹
  - æ¨¡å¼ 4ï¼šæ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹
- å¯¹è±¡åºåˆ—åŒ–

![](md-imgs/2024-10-05-22-35-18.png)

## 5. ğŸ“ send vs. sendSync

ipcRenderer.send å’Œ ipcRenderer.sendSync è¿™ä¿© APIï¼Œå¯ä»¥è®¤ä¸ºå®ƒä»¬å·²ç»è¿‡æ—¶äº†ï¼Œé‡ç‚¹æŒæ¡å¥½ ipcRenderer.invoke å³å¯ã€‚

### 5.1. sendã€sendSync æ˜¯ä»€ä¹ˆ

è¿™é‡Œæ‰€è¯´çš„ send æ˜¯æŒ‡ ipcRenderer.sendï¼ŒsendSync æ˜¯æŒ‡ ipcRenderer.sendSyncã€‚

ipcRenderer.send å’Œ ipcRenderer.sendSync å®ƒä»¬éƒ½æ˜¯ Electron çš„ ipcRenderer æ¨¡å—ä¸­ç”¨äºå‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹çš„æ–¹æ³•ã€‚ä½†æ˜¯å®ƒä»¬åœ¨å‘é€æ¶ˆæ¯çš„æ–¹å¼ä¸Šæœ‰ä¸€äº›å·®å¼‚ï¼Œå…¶ä¸­æœ€æ˜æ˜¾çš„å·®å¼‚å°±æ˜¯ send æ˜¯å¼‚æ­¥çš„ï¼ŒsendSync æ˜¯åŒæ­¥çš„ã€‚

### 5.2. åŒæ­¥ vs. å¼‚æ­¥

ä¸‹é¢ï¼Œæˆ‘ä»¬ä»â€œåŒæ­¥â€ã€â€œå¼‚æ­¥â€çš„è§’åº¦æ¥å¯¹æ¯”ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ã€‚

ipcRenderer.send æ˜¯ä¸€ä¸ª **å¼‚æ­¥** æ–¹æ³•ï¼Œå®ƒä¼šç«‹å³è¿”å›ï¼Œ**ä¸ä¼šé˜»å¡æ¸²æŸ“è¿›ç¨‹**ã€‚å½“ä¸»è¿›ç¨‹æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å¤„ç†å®Œåï¼Œå¦‚æœéœ€è¦å›å¤æ¶ˆæ¯ï¼Œä¸»è¿›ç¨‹ä¼šå†å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™æ¸²æŸ“è¿›ç¨‹ï¼Œæ¸²æŸ“è¿›ç¨‹éœ€è¦å¦å¤–è®¾ç½®ç›‘å¬æ¥æ¥æ”¶ã€‚

ipcRenderer.sendSync æ˜¯ä¸€ä¸ª **åŒæ­¥** æ–¹æ³•ï¼Œå®ƒ **ä¼šé˜»å¡æ¸²æŸ“è¿›ç¨‹**ï¼Œç­‰å¾…ä¸»è¿›ç¨‹æ¥æ”¶æ¶ˆæ¯å¹¶è¿”å›ç»“æœã€‚å½“è¿™ä¸ªæ–¹æ³•è¿”å›æ—¶ï¼Œè¿”å›çš„å°±æ˜¯ä¸»è¿›ç¨‹å¤„ç†çš„ç»“æœã€‚åœ¨ä¸»è¿›ç¨‹è¿”å›ç»“æœä¹‹å‰ï¼Œæ¸²æŸ“è¿›ç¨‹å°†å§‹ç»ˆå¤„äºé˜»å¡çŠ¶æ€ã€‚

ç”±äº ipcRenderer.send æ˜¯éé˜»å¡çš„ï¼Œä»æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒè§’åº¦æ¥çœ‹ï¼Œå®ƒé€šå¸¸éƒ½ä¼˜äº ipcRenderer.sendSyncã€‚å› ä¸º ipcRenderer.sendSync ä¼šé˜»å¡æ¸²æŸ“è¿›ç¨‹ï¼Œç›´åˆ°ä¸»è¿›ç¨‹è¿”å›ç»“æœï¼Œè¿™å°†ä¼šå¯¼è‡´æ¸²æŸ“è¿›ç¨‹ç•Œé¢çš„æš‚åœæˆ–å¡é¡¿ï¼Œå¾ˆå½±å“ç”¨æˆ·ä½“éªŒã€‚

éœ€è¦çŸ¥é“ï¼Œé˜»å¡ JavaScript çš„æ‰§è¡Œçº¿ç¨‹æ˜¯éå¸¸å±é™©çš„ã€‚å› ä¸º JavaScript æœ¬èº«å°±æ˜¯å•çº¿ç¨‹è¿è¡Œï¼Œä¸€æ—¦æŸä¸ªæ–¹æ³•é˜»å¡äº†è¿™ä¸ªä»…æœ‰çš„çº¿ç¨‹ï¼ŒJavaScript çš„è¿è¡Œå°±åœæ»äº†ï¼Œåªèƒ½ç­‰è¿™ä¸ªæ–¹æ³•é€€å‡ºã€‚å‡è®¾æ­¤æ—¶é¢„æœŸéœ€è¦æœ‰ä¸€ä¸ª setTimeout äº‹ä»¶æˆ– setInterval äº‹ä»¶è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆæ­¤é¢„æœŸä¹Ÿè½ç©ºäº†ã€‚è¿™å¯èƒ½ä½¿æˆ‘ä»¬çš„ä¸šåŠ¡å¤„äºä¸å¯çŸ¥çš„å¼‚å¸¸ä¸­ã€‚JavaScript è¯­è¨€æœ¬èº«ä»¥â€œå¼‚æ­¥ç¼–ç¨‹â€è‘—ç§°ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…ç”¨å®ƒçš„åŒæ­¥æ–¹æ³•å’Œé•¿è€—æ—¶æ–¹æ³•ï¼Œé¿å…é€ æˆæ‰§è¡Œçº¿ç¨‹é˜»å¡ã€‚

è¿™é‡Œé¡ºå¸¦ç€æä¸€å˜´ï¼ŒElectron ä¸­çš„ remote æ¨¡å—ä¸æ¨èä½¿ç”¨çš„åŸå› ä¹‹ä¸€ä¹Ÿæ˜¯å› ä¸ºå®ƒåº•å±‚çš„æ‰§è¡Œé€»è¾‘æ˜¯åŒæ­¥çš„ï¼Œç©ä¸å¥½å¾ˆå¯èƒ½å¯¼è‡´ç¨‹åºå¡æ­»ã€‚

### 5.3. è¿”å›å€¼

**Qï¼šå¦‚æœä»è¿”å›å€¼çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬ä¸¤è€…ä¹‹é—´åˆæœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ**

ipcRenderer.send çš„è¿”å›å€¼æ˜¯ undefinedï¼Œå› ä¸ºå®ƒåªæ˜¯å‘é€æ¶ˆæ¯ï¼Œä¸å…³å¿ƒä¸»è¿›ç¨‹æ˜¯å¦æœ‰è¿”å›ç»“æœã€‚

ipcRenderer.sendSync çš„è¿”å›å€¼æ˜¯ä¸»è¿›ç¨‹å¤„ç†ç»“æœï¼Œå› ä¸ºå®ƒä¼šç­‰å¾…ä¸»è¿›ç¨‹å¤„ç†å®Œæ¶ˆæ¯å¹¶è¿”å›ç»“æœã€‚

é€šè¿‡ä¸Šè¿°çš„å¯¹æ¯”åˆ†æï¼Œä½ å¯èƒ½ä¼šå¾—å‡ºä»¥ä¸‹â€œè¿‡æ—¶çš„â€ç»“è®ºã€‚

å¦‚æœæˆ‘ä»¬çš„åº”ç”¨å¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚ï¼Œæˆ–è€…ä¸éœ€è¦å³åˆ»å¾—åˆ°ä¸»è¿›ç¨‹å¤„ç†çš„ç»“æœï¼Œé‚£ä¹ˆåº”ä¼˜å…ˆä½¿ç”¨ ipcRenderer.sendã€‚

å¦‚æœæˆ‘ä»¬çš„åº”ç”¨éœ€è¦å³åˆ»å¾—åˆ°ä¸»è¿›ç¨‹å¤„ç†çš„ç»“æœï¼Œå¹¶ä¸”å¯¹å¯èƒ½çš„æ€§èƒ½å½±å“å¯ä»¥æ¥å—ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ ipcRenderer.sendSyncã€‚

å…¶å®ä¸Šè¿°è¯´æ³•æ˜¯æ²¡é”™çš„ï¼Œä¸è¿‡ç°åœ¨æœ‰æ¯” send æ›´ä¼˜çš„é€‰æ‹© â€”â€” invokeï¼Œæ‰€ä»¥è¯´æ˜¯â€œè¿‡æ—¶â€çš„ç»“è®ºã€‚

### 5.4. çœ‹çœ‹å®˜æ–¹å»ºè®®

ä¸Šè¿°æåˆ°çš„ç»“è®ºçœŸçš„â€œè¿‡æ—¶â€äº†ï¼Ÿè¿™æ—¶å€™å¯ä»¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹å»ºè®®ã€‚

![](md-imgs/2024-10-05-22-39-45.png)

ç®€è¨€ä¹‹å°±æ˜¯ï¼Œ**å¦‚æœæˆ‘ä»¬å¼€å‘çš„åº”ç”¨æ‰€ä½¿ç”¨çš„ Electron çš„ç‰ˆæœ¬é«˜äº v7ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨æ–°ç‰ˆçš„ API ipcRenderer.invoke æ¥å®ç°æ¸²æŸ“è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚æ”¾å¼ƒä½¿ç”¨ä¼ ç»Ÿçš„ ipcRenderer.sendã€ipcRenderer.sendSyncã€‚**

## 6. ğŸ“ send vs. invoke

### 6.1. å…ˆç»™å‡ºç»“è®º

- ipcRenderer.invoke æ–°ç‰ˆ API
- ipcRenderer.invoke ä»å¥åœ¨
- ~~ipcRenderer.send æ—§ç‰ˆ API~~
- ~~ipcRenderer.send å·²æ·˜æ±°~~

---

- ä¸¤è€…éƒ½æ˜¯å¼‚æ­¥çš„
- ä»èƒ½åŠ›è§’åº¦æ¥çœ‹ send = invoke
  - send èƒ½åšçš„ï¼Œinvoke éƒ½èƒ½åš
  - invoke èƒ½åšçš„ï¼Œsend ä¹Ÿéƒ½èƒ½åš
- ä»ä½¿ç”¨ä½“éªŒæ¥çœ‹ invoke > sendã€‚é’ˆå¯¹ä¸€äº›å¸¸è§çš„é€šä¿¡åœºæ™¯ï¼Œæ¯”å¦‚åŒå‘é€šä¿¡ï¼Œinvoke å†™èµ·æ¥æ¯” send æ›´èˆ’æœã€‚

### 6.2. åœºæ™¯ - åŒå‘é€šä¿¡

å‡è®¾æˆ‘ä»¬éœ€è¦å®ç°è¿™æ ·ä¸€ç§é€šä¿¡çš„åœºæ™¯ï¼š

æ¸²æŸ“è¿›ç¨‹ç»™ä¸»è¿›ç¨‹å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…æ¥æ”¶ä¸»è¿›ç¨‹çš„å¤„ç†ç»“æœï¼Œæ‹¿åˆ°å¤„ç†ç»“æœä¹‹åå†æ‰§è¡Œåç»­æ“ä½œï¼Œè¦æ±‚è¿™ä¸ªè¿‡ç¨‹ä¸èƒ½é˜»å¡ç¨‹åºçš„æ‰§è¡Œã€‚

å…¶å®ï¼Œå®ç°çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œç”±äºä¸èƒ½é˜»å¡ç¨‹åºçš„æ‰§è¡Œï¼Œé¦–å…ˆè¢«æ”¾å¼ƒçš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ ipcRenderer.sendSyncã€‚ç„¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ ipcRenderer.sendã€ipcRenderer.invokeã€‚

invoke æ›´ç®€æ´ã€‚ä»…éœ€è¦ä¸€ä¸ªäº‹ä»¶å³å¯å®Œæˆé€šä¿¡ã€‚åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œé€šè¿‡ ipcRenderer.invoke å°†è¯·æ±‚å‘é€ç»™ä¸»è¿›ç¨‹ï¼Œåœ¨ä¸»è¿›ç¨‹çš„ ipcMain.handle ä¸­ï¼Œå°†å¤„ç†å®Œçš„ç»“æœç›´æ¥ return å³å¯è¿”å›ç»™æˆ‘ä»¬çš„æ¸²æŸ“è¿›ç¨‹ã€‚

send æ›´éº»çƒ¦ã€‚å› ä¸ºéœ€è¦ç»‘å®šä¿©äº‹ä»¶ï¼š
- äº‹ä»¶ 1ï¼šæ¸²æŸ“è¿›ç¨‹å‘èµ·è¯·æ±‚ï¼Œä¸»è¿›ç¨‹æ¥æ”¶è¯·æ±‚
- äº‹ä»¶ 2ï¼šä¸»è¿›ç¨‹å‘èµ·å“åº”ï¼Œæ¸²æŸ“è¿›ç¨‹æ¥æ”¶å“åº”
ç»‘å®šä¿©äº‹ä»¶å¤„ç†å‡½æ•°å€’ä¹Ÿä¸éš¾ï¼Œç—›è‹¦çš„æ˜¯ä½ éœ€è¦å°†æœ¬è¯¥åœ¨ä¸€èµ·çš„é€»è¾‘ç»™æ‹†åˆ°ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ã€‚æ— è®ºæ˜¯å¯¹å†™ä»£ç çš„äººè¿˜æ˜¯åç»­è¯»ä»£ç çš„äººï¼Œéƒ½æ˜¯å¾ˆä¸å‹å¥½çš„ã€‚

ä»ä¸Šé¢æè¿°çš„åœºæ™¯æ¥çœ‹ï¼Œæ˜¾ç„¶æ²¡æœ‰å¿…è¦ä½¿ç”¨ sendã€‚

### 6.3. åœºæ™¯ - å•å‘é€šä¿¡

å¦‚æœä»…ä»…æ˜¯æ¸²æŸ“è¿›ç¨‹å‘èµ·è¯·æ±‚ï¼Œä¸éœ€è¦ç®¡ä¸»è¿›ç¨‹çš„å“åº”ï¼Œä¹Ÿå°±æ˜¯å•å‘é€šä¿¡ï¼Œsend å’Œ invoke åˆæœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼Œ**å‡ ä¹æ²¡æœ‰åŒºåˆ«**ã€‚

## 7. ğŸ¤” é—®ï¼šä½¿ç”¨ send æ¥å®ç°å•å‘é€šä¿¡èƒ½å‡å°‘å¼€é”€æé«˜æ€§èƒ½ï¼Ÿ

è¿™æ˜¯ä¸€ä½ç½‘å‹æçš„é—®é¢˜ï¼Œç”±äºç¼ºä¹è®ºæ®ï¼Œå¹¶ä¸”ä¹Ÿæ²¡åœ¨å®˜æ–¹æ–‡æ¡£æ‰¾åˆ°æ”¯æŒè¿™ç§è¯´æ³•çš„ç‚¹ï¼Œå› æ­¤æš‚ä¸”è®¤ä¸ºè¿™ç§è¯´æ³•æ˜¯ä¸æˆç«‹çš„ã€‚

![](md-imgs/2024-10-05-22-42-58.png)

> å’¨è¯¢æ—¶é—´ï¼š24.06.27
>
> é¡ºå¸¦æä¸€å˜´ - ä¸ä¹ æƒ¯è¢«ç§°å‘¼ä¸ºè€å¸ˆã€‚
> - å¯ä»¥æŠŠè€å¸ˆç»™å»æ‰ï¼Œç›´æ¥é—®é—®é¢˜ï¼›
> - ä¹Ÿå¯ä»¥æŠŠè€å¸ˆæ›¿æ¢ä¸º upï¼›
>
> çœ‹åˆ°æ¶ˆæ¯åä¼šå°½å¿«å»å›å¤ã€‚

![](md-imgs/2024-10-05-22-46-44.png)

